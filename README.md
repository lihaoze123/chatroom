# å®æ—¶ Web èŠå¤©åº”ç”¨

ä¸€ä¸ªåŸºäº **Flask** å’Œ **WebSocket (Flask-SocketIO)** æ„å»ºçš„ç°ä»£å®æ—¶ Web èŠå¤©åº”ç”¨ã€‚

## æŠ€æœ¯æ ˆ

- [Python](https://www.python.org/)
- [Flask](https://flask.palletsprojects.com/)
- [Flask-SocketIO](https://flask-socketio.readthedocs.io/en/latest/)
- [Flask-SQLAlchemy](https://flask-sqlalchemy.palletsprojects.com/)
- [Flask-Login](https://flask-login.readthedocs.io/en/latest/)

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªåŸºäº Web çš„å®æ—¶èŠå¤©å¹³å°ï¼Œå…è®¸ç”¨æˆ·æ³¨å†Œã€ç™»å½•ï¼Œå¹¶åœ¨å…¬å…±èŠå¤©å®¤ä¸­ä¸å…¶ä»–åœ¨çº¿ç”¨æˆ·è¿›è¡Œå®æ—¶äº¤æµã€‚æ¶ˆæ¯å‘é€åå°†å³æ—¶æ˜¾ç¤ºåœ¨æ‰€æœ‰ç”¨æˆ·çš„å±å¹•ä¸Šï¼Œæ— éœ€åˆ·æ–°é¡µé¢ã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

  * âœ… **ç”¨æˆ·è®¤è¯**: å®‰å…¨çš„æ³¨å†Œã€ç™»å½•å’Œç™»å‡ºåŠŸèƒ½ã€‚
  * âœ… **å®æ—¶æ¶ˆæ¯**: åŸºäº WebSocket çš„å¤šç”¨æˆ·å®æ—¶æ–‡æœ¬é€šä¿¡ã€‚
  * âœ… **æˆ¿é—´/ç¾¤èŠ**: æ”¯æŒåŠ å…¥å’Œç¦»å¼€ä¸åŒçš„èŠå¤©å®¤ã€‚
  * âœ… **åœ¨çº¿çŠ¶æ€**: å®æ—¶æ˜¾ç¤ºç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ã€‚
  * âœ… **æ­£åœ¨è¾“å…¥æç¤º**: å½“å¯¹æ–¹æ­£åœ¨è¾“å…¥æ—¶ï¼Œä¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯ã€‚
  * âœ… **æ¶ˆæ¯å†å²åŠ è½½**: é€šè¿‡å‘ä¸Šæ»šåŠ¨æ–¹å¼é«˜æ•ˆåŠ è½½å†å²æ¶ˆæ¯ã€‚
  * âœ… **å¯Œåª’ä½“æ”¯æŒ**: æ”¯æŒå‘é€è¡¨æƒ…ç¬¦å·ï¼Œå¹¶è§„åˆ’äº†å®‰å…¨çš„æ–‡ä»¶/å›¾ç‰‡ä¸Šä¼ æ¥å£ã€‚
  * âœ… **æµè§ˆå™¨é€šçŸ¥**: å½“åº”ç”¨åœ¨åå°æ—¶ï¼Œé€šè¿‡æµè§ˆå™¨æ¡Œé¢é€šçŸ¥æé†’æ–°æ¶ˆæ¯ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
  * **Flask** - Webæ¡†æ¶
  * **Flask-SocketIO** - WebSocketæ”¯æŒ
  * **Flask-SQLAlchemy** - ORMæ•°æ®åº“æ“ä½œ
  * **Flask-Login** - ç”¨æˆ·è®¤è¯
  * **Flask-CORS** - è·¨åŸŸèµ„æºå…±äº«
  * **SQLite** - æ•°æ®åº“
  * **Eventlet** - å¼‚æ­¥æœåŠ¡å™¨

### å‰ç«¯
  * **React 19.1.0** - ç”¨æˆ·ç•Œé¢åº“
  * **TypeScript** - ç±»å‹å®‰å…¨çš„JavaScript
  * **TailwindCSS 3.4.17** - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
  * **shadcn/ui** - ç°ä»£åŒ–UIç»„ä»¶åº“
  * **Radix UI** - æ— éšœç¢è®¿é—®çš„åŸå§‹ç»„ä»¶
  * **Socket.IO Client** - å®æ—¶é€šä¿¡
  * **Axios** - HTTPå®¢æˆ·ç«¯
  * **React Router** - è·¯ç”±ç®¡ç†
  * **React Hot Toast** - é€šçŸ¥ç»„ä»¶

### å·¥å…·é“¾
  * **uv** - PythonåŒ…ç®¡ç†
  * **npm** - Node.jsåŒ…ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

è¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£… [Python](https://www.python.org/) å’Œ [Node.js](https://nodejs.org/)ã€‚

### ç¯å¢ƒè¦æ±‚

- **Python 3.8+**
- **Node.js 16+**
- **npm æˆ– yarn**

### 1\. å…‹éš†ä»“åº“

```bash
git clone https://github.com/lihaoze123/chatroom.git
cd chatroom
```

### 2\. åç«¯è®¾ç½®

#### åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```bash
# ä½¿ç”¨ uv (æ¨è)
uv venv
source .venv/bin/activate  # Linux/macOS
# æˆ– .venv\Scripts\activate  # Windows

# æˆ–ä½¿ç”¨ Python å†…ç½® venv
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# æˆ– .venv\Scripts\activate  # Windows
```

#### å®‰è£…åç«¯ä¾èµ–

```bash
# ä½¿ç”¨ uv (æ¨è)
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -r requirements.txt
```

#### åˆå§‹åŒ–æ•°æ®åº“

```bash
python init_db.py
```

### 3\. å‰ç«¯è®¾ç½®

```bash
cd frontend
npm install

# æ„å»º shadcn/ui æ ·å¼
npm run build-css-once
```

### 4\. å¯åŠ¨åº”ç”¨

#### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
./start.sh
```

è¿™å°†åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯æœåŠ¡å™¨ã€‚

#### æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨

**å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼š**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
python run.py
```

**å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼š**
```bash
# åœ¨ frontend ç›®å½•
cd frontend

# æœ¬åœ°è®¿é—®
npm start

# å±€åŸŸç½‘è®¿é—®ï¼ˆå…è®¸å…¶ä»–è®¾å¤‡è®¿é—®ï¼‰
npm run start:network
```

### 5\. è®¿é—®åº”ç”¨

- **æœ¬åœ°è®¿é—®**ï¼š`http://localhost:3000`
- **å±€åŸŸç½‘è®¿é—®**ï¼š`http://[æœåŠ¡å™¨IP]:3000`ï¼ˆä¾‹å¦‚ï¼š`http://192.168.1.100:3000`ï¼‰

## ğŸŒ å±€åŸŸç½‘è®¿é—®é…ç½®

### è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰

åº”ç”¨å·²æ”¯æŒè‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨åœ°å€ï¼š

1. **å¯åŠ¨åç«¯æœåŠ¡å™¨**ï¼š
   ```bash
   python run.py
   ```
   åç«¯ä¼šè‡ªåŠ¨ç»‘å®šåˆ° `0.0.0.0:5000`ï¼Œæ”¯æŒå±€åŸŸç½‘è®¿é—®ã€‚

2. **å¯åŠ¨å‰ç«¯æœåŠ¡å™¨ï¼ˆæ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼‰**ï¼š
   ```bash
   cd frontend
   npm run start:network
   ```

3. **ä»å±€åŸŸç½‘è®¾å¤‡è®¿é—®**ï¼š
   - è·å–æœåŠ¡å™¨IPåœ°å€ï¼ˆå¦‚ `192.168.1.100`ï¼‰
   - åœ¨å…¶ä»–è®¾å¤‡ä¸Šè®¿é—®ï¼š`http://192.168.1.100:3000`
   - å‰ç«¯ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ `http://192.168.1.100:5000` ä½œä¸ºAPIåœ°å€

### æ‰‹åŠ¨é…ç½®

å¦‚æœéœ€è¦æ‰‹åŠ¨æŒ‡å®šæœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

1. **åˆ›å»ºå‰ç«¯ç¯å¢ƒé…ç½®**ï¼š
   ```bash
   # åœ¨ frontend ç›®å½•ä¸‹åˆ›å»º .env æ–‡ä»¶
   cd frontend
   cat > .env << EOF
   # æ›¿æ¢ä¸ºå®é™…çš„æœåŠ¡å™¨IPåœ°å€
   REACT_APP_API_URL=http://192.168.1.100:5000
   REACT_APP_SOCKET_URL=http://192.168.1.100:5000
   EOF
   ```

2. **é‡å¯å‰ç«¯æœåŠ¡å™¨**ï¼š
   ```bash
   npm start
   ```

### è·å–æœåŠ¡å™¨IPåœ°å€

```bash
# Linux/macOS
ip addr show | grep inet
# æˆ–
ifconfig | grep inet

# Windows
ipconfig
```

## ğŸ“± ä½¿ç”¨è¯´æ˜

### ç”¨æˆ·æ³¨å†Œå’Œç™»å½•

1. **è®¿é—®åº”ç”¨**ï¼šæ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
2. **æ³¨å†Œè´¦æˆ·**ï¼š
   - ç‚¹å‡»"æ³¨å†Œ"æŒ‰é’®
   - å¡«å†™ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç 
   - å¯†ç è‡³å°‘6ä½å­—ç¬¦
   - ç‚¹å‡»"æ³¨å†Œ"å®Œæˆè´¦æˆ·åˆ›å»º
3. **ç™»å½•**ï¼š
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   - å¯é€‰æ‹©"è®°ä½æˆ‘"ä¿æŒç™»å½•çŠ¶æ€
   - ç‚¹å‡»"ç™»å½•"è¿›å…¥èŠå¤©ç•Œé¢

### èŠå¤©åŠŸèƒ½

#### åŠ å…¥èŠå¤©å®¤

1. **æŸ¥çœ‹èŠå¤©å®¤åˆ—è¡¨**ï¼šç™»å½•åä¼šæ˜¾ç¤ºå¯ç”¨çš„èŠå¤©å®¤
2. **åŠ å…¥èŠå¤©å®¤**ï¼šç‚¹å‡»èŠå¤©å®¤å¡ç‰‡è¿›å…¥
3. **æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·**ï¼šå³ä¾§æ˜¾ç¤ºå½“å‰åœ¨çº¿çš„ç”¨æˆ·åˆ—è¡¨

#### å‘é€æ¶ˆæ¯

1. **æ–‡æœ¬æ¶ˆæ¯**ï¼šåœ¨åº•éƒ¨è¾“å…¥æ¡†è¾“å…¥æ–‡æœ¬ï¼ŒæŒ‰Enterå‘é€
2. **è¡¨æƒ…ç¬¦å·**ï¼šç‚¹å‡»ğŸ˜ŠæŒ‰é’®é€‰æ‹©è¡¨æƒ…
3. **æ­£åœ¨è¾“å…¥æç¤º**ï¼šè¾“å…¥æ—¶å…¶ä»–ç”¨æˆ·ä¼šçœ‹åˆ°"æ­£åœ¨è¾“å…¥..."æç¤º

#### åˆ›å»ºèŠå¤©å®¤

1. **ç‚¹å‡»"åˆ›å»ºæˆ¿é—´"æŒ‰é’®**
2. **å¡«å†™æˆ¿é—´ä¿¡æ¯**ï¼š
   - æˆ¿é—´åç§°ï¼ˆå¿…å¡«ï¼‰
   - æˆ¿é—´æè¿°ï¼ˆå¯é€‰ï¼‰
   - é€‰æ‹©æˆ¿é—´ç±»å‹ï¼ˆå…¬å¼€/ç§æœ‰ï¼‰
3. **ç‚¹å‡»"åˆ›å»º"å®Œæˆ**

### é«˜çº§åŠŸèƒ½

#### æ¶ˆæ¯å†å²

- **è‡ªåŠ¨åŠ è½½**ï¼šè¿›å…¥èŠå¤©å®¤æ—¶è‡ªåŠ¨åŠ è½½æœ€è¿‘50æ¡æ¶ˆæ¯
- **å†å²åŠ è½½**ï¼šå‘ä¸Šæ»šåŠ¨å¯åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯
- **æ™ºèƒ½æ»šåŠ¨**ï¼šæ–°æ¶ˆæ¯åˆ°è¾¾æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

#### æ¡Œé¢é€šçŸ¥

- **å¯ç”¨é€šçŸ¥**ï¼šé¦–æ¬¡è®¿é—®æ—¶æµè§ˆå™¨ä¼šè¯·æ±‚é€šçŸ¥æƒé™
- **åå°æé†’**ï¼šå½“æµè§ˆå™¨æ ‡ç­¾é¡µä¸åœ¨å‰å°æ—¶ï¼Œæ–°æ¶ˆæ¯ä¼šè§¦å‘æ¡Œé¢é€šçŸ¥
- **ç‚¹å‡»é€šçŸ¥**ï¼šç‚¹å‡»é€šçŸ¥å¯å¿«é€Ÿå›åˆ°èŠå¤©ç•Œé¢

#### åœ¨çº¿çŠ¶æ€

- **å®æ—¶æ›´æ–°**ï¼šç”¨æˆ·ä¸Šçº¿/ä¸‹çº¿çŠ¶æ€å®æ—¶æ˜¾ç¤º
- **åœ¨çº¿æŒ‡ç¤ºå™¨**ï¼šç”¨æˆ·å¤´åƒæ—çš„ç»¿ç‚¹è¡¨ç¤ºåœ¨çº¿çŠ¶æ€
- **ç”¨æˆ·è®¡æ•°**ï¼šæ˜¾ç¤ºå½“å‰èŠå¤©å®¤çš„åœ¨çº¿ç”¨æˆ·æ•°é‡

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨

**ç—‡çŠ¶**ï¼šå‰ç«¯æ˜¾ç¤ºè¿æ¥é”™è¯¯ï¼ŒAPIè¯·æ±‚å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š`ps aux | grep run.py`
- ç¡®è®¤ç«¯å£5000æœªè¢«å ç”¨ï¼š`netstat -tlnp | grep :5000`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿5000ç«¯å£å¼€æ”¾
- æŸ¥çœ‹åç«¯æ—¥å¿—è¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

#### 2. Socket.IOè¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šå®æ—¶æ¶ˆæ¯åŠŸèƒ½ä¸å·¥ä½œï¼Œæ§åˆ¶å°æ˜¾ç¤ºWebSocketé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®è®¤Socket.IOæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥CORSé…ç½®æ˜¯å¦æ­£ç¡®
- å°è¯•åˆ·æ–°é¡µé¢é‡æ–°å»ºç«‹è¿æ¥

#### 3. å±€åŸŸç½‘è®¾å¤‡æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šå…¶ä»–è®¾å¤‡æ— æ³•è®¿é—®èŠå¤©åº”ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ `npm run start:network` å¯åŠ¨
- æ£€æŸ¥æœåŠ¡å™¨IPåœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®è®¤é˜²ç«å¢™å…è®¸3000å’Œ5000ç«¯å£çš„å…¥ç«™è¿æ¥
- éªŒè¯è®¾å¤‡é—´ç½‘ç»œè¿é€šæ€§ï¼š`ping [æœåŠ¡å™¨IP]`

#### 4. å‰ç«¯æ ·å¼ä¸æ˜¾ç¤º

**ç—‡çŠ¶**ï¼šé¡µé¢å¸ƒå±€æ··ä¹±ï¼Œæ ·å¼ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°æ„å»ºCSSï¼š`npm run build-css-once`
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥TailwindCSSé…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ‰€æœ‰å‰ç«¯ä¾èµ–å·²æ­£ç¡®å®‰è£…
- éªŒè¯ shadcn/ui ç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥

#### 5. æ•°æ®åº“ç›¸å…³é”™è¯¯

**ç—‡çŠ¶**ï¼šç”¨æˆ·æ³¨å†Œ/ç™»å½•å¤±è´¥ï¼Œæ•°æ®ä¿å­˜é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š`python init_db.py`
- æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
- æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®è®¤SQLiteæ•°æ®åº“æ–‡ä»¶è·¯å¾„æ­£ç¡®

### è°ƒè¯•æ¨¡å¼

#### å¯ç”¨è¯¦ç»†æ—¥å¿—

1. **åç«¯è°ƒè¯•**ï¼š
   ```bash
   export FLASK_ENV=development
   export LOG_LEVEL=DEBUG
   python run.py
   ```

2. **å‰ç«¯è°ƒè¯•**ï¼š
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - æŸ¥çœ‹Consoleæ ‡ç­¾é¡µçš„æ—¥å¿—è¾“å‡º
   - æ£€æŸ¥Networkæ ‡ç­¾é¡µçš„è¯·æ±‚çŠ¶æ€

#### éªŒè¯é…ç½®

1. **æ£€æŸ¥APIè¿æ¥**ï¼š
   ```bash
   curl -X GET http://localhost:5000/api/auth/check
   ```

2. **æ£€æŸ¥Socket.IOè¿æ¥**ï¼š
   ```bash
   curl -X GET "http://localhost:5000/socket.io/?EIO=4&transport=polling"
   ```

3. **éªŒè¯å‰ç«¯é…ç½®**ï¼š
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹ "API Base URL" å’Œ "Socket URL" çš„è¾“å‡º

### æ€§èƒ½ä¼˜åŒ–

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **æ„å»ºå‰ç«¯**ï¼š
   ```bash
   cd frontend
   npm run build
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   export FLASK_ENV=production
   export SECRET_KEY=your-secret-key
   export DATABASE_URL=your-database-url
   ```

3. **ä½¿ç”¨ç”Ÿäº§æœåŠ¡å™¨**ï¼š
   ```bash
   # ä½¿ç”¨ Gunicorn
   pip install gunicorn
   gunicorn -k eventlet -w 1 --bind 0.0.0.0:5000 run:app
   ```

#### æ•°æ®åº“ä¼˜åŒ–

- **è¿ç§»åˆ°PostgreSQL**ï¼šç”¨äºç”Ÿäº§ç¯å¢ƒ
- **æ·»åŠ æ•°æ®åº“ç´¢å¼•**ï¼šä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **å®šæœŸå¤‡ä»½**ï¼šç¡®ä¿æ•°æ®å®‰å…¨

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ

- é»˜è®¤é…ç½®ä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒ
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é»˜è®¤çš„SECRET_KEY
- å±€åŸŸç½‘è®¿é—®åŠŸèƒ½ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨

### ç”Ÿäº§ç¯å¢ƒ

- ä½¿ç”¨HTTPSåè®®
- é…ç½®å¼ºå¯†ç ç­–ç•¥
- é™åˆ¶CORSå…è®¸çš„æ¥æº
- å¯ç”¨æ—¥å¿—è®°å½•å’Œç›‘æ§
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®

- **åº”ç”¨æ—¥å¿—**ï¼š`logs/app.log`
- **é”™è¯¯æ—¥å¿—**ï¼šæ§åˆ¶å°è¾“å‡º
- **è®¿é—®æ—¥å¿—**ï¼šåŒ…å«åœ¨åº”ç”¨æ—¥å¿—ä¸­

### ç›‘æ§æŒ‡æ ‡

- **è¿æ¥æ•°**ï¼šå½“å‰WebSocketè¿æ¥æ•°é‡
- **æ¶ˆæ¯é‡**ï¼šæ¯åˆ†é’Ÿæ¶ˆæ¯å‘é€æ•°é‡
- **ç”¨æˆ·æ´»è·ƒåº¦**ï¼šåœ¨çº¿ç”¨æˆ·æ•°é‡å˜åŒ–
- **é”™è¯¯ç‡**ï¼šAPIè¯·æ±‚å¤±è´¥ç‡

## ğŸ“ é¡¹ç›®ç»“æ„

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–çš„è“å›¾ï¼ˆBlueprintï¼‰ç»“æ„ï¼Œä¿æŒä»£ç çš„æ•´æ´å’Œé«˜å¯ç»´æŠ¤æ€§ã€‚

```
chatroom/
â”œâ”€â”€ app/                      # åç«¯åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ __init__.py           # åº”ç”¨å·¥å‚å’Œ Blueprint æ³¨å†Œ
â”‚   â”œâ”€â”€ api/                  # API Blueprint (ä¸ºå‰ç«¯æä¾›æ¥å£)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py           # è®¤è¯API
â”‚   â”‚   â””â”€â”€ chat.py           # èŠå¤©API
â”‚   â”œâ”€â”€ auth/                 # è®¤è¯ Blueprint (ä¼ ç»ŸWeb)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes.py         # è®¤è¯ç›¸å…³çš„ HTTP è·¯ç”±
â”‚   â”‚   â””â”€â”€ forms.py          # è®¤è¯è¡¨å•
â”‚   â”œâ”€â”€ chat/                 # èŠå¤© Blueprint
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes.py         # èŠå¤©å®¤é¡µé¢ HTTP è·¯ç”±
â”‚   â”‚   â””â”€â”€ events.py         # Socket.IO äº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ main/                 # ä¸»è¦åº”ç”¨ Blueprint
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ routes.py         # é¦–é¡µç­‰ä¸»è¦é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ models.py             # SQLAlchemy æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ socket_events.py      # Socket.IO äº‹ä»¶å¤„ç†å™¨
â”‚   â”œâ”€â”€ static/               # é™æ€æ–‡ä»¶ (CSS, JavaScript, Images)
â”‚   â””â”€â”€ templates/            # Jinja2 æ¨¡æ¿
â”œâ”€â”€ frontend/                 # Reactå‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ public/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ src/                  # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ components/       # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/         # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ chat/         # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ contexts/         # Reactä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ChatContext.tsx
â”‚   â”‚   â”œâ”€â”€ pages/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/         # APIå’ŒSocketæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts        # HTTP APIæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ socket.ts     # Socket.IOå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ types/            # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ package.json          # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ README.md             # å‰ç«¯æ–‡æ¡£
â”œâ”€â”€ instance/                 # å®ä¾‹æ–‡ä»¶å¤¹
â”‚   â””â”€â”€ app.db               # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ logs/                     # æ—¥å¿—æ–‡ä»¶å¤¹
â”‚   â””â”€â”€ app.log              # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ config.py                 # åº”ç”¨é…ç½®
â”œâ”€â”€ run.py                    # åº”ç”¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ init_db.py               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ start.sh                  # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®å®šä¹‰å’Œä¾èµ–ç®¡ç†
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”Œ Socket.IO æ ¸å¿ƒäº‹ä»¶

å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒäº‹ä»¶å®Œæˆï¼š

### è¿æ¥ç®¡ç†äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `connect` | `S <-> C` | å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹è¿æ¥ | - |
| `disconnect` | `S <-> C` | å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ | `{ reason: string }` |

### æˆ¿é—´ç®¡ç†äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `join_room` | `C -> S` | å®¢æˆ·ç«¯è¯·æ±‚åŠ å…¥èŠå¤©å®¤ | `{ room_id: number }` |
| `leave_room` | `C -> S` | å®¢æˆ·ç«¯è¯·æ±‚ç¦»å¼€èŠå¤©å®¤ | `{ room_id: number }` |
| `room_joined` | `S -> C` | æœåŠ¡å™¨ç¡®è®¤ç”¨æˆ·å·²åŠ å…¥æˆ¿é—´ | `{ room_id: number, room_name: string, member_count: number, online_members: User[] }` |
| `user_joined` | `S -> C` | é€šçŸ¥æœ‰ç”¨æˆ·åŠ å…¥æˆ¿é—´ | `{ user_id: number, username: string, room_id: number }` |
| `user_left` | `S -> C` | é€šçŸ¥æœ‰ç”¨æˆ·ç¦»å¼€æˆ¿é—´ | `{ user_id: number, username: string, room_id: number }` |

### æ¶ˆæ¯äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `send_message` | `C -> S` | å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šæˆ¿é—´ | `{ room_id: number, content: string }` |
| `new_message` | `S -> C` | æœåŠ¡å™¨å‘æˆ¿é—´å†…æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­æ–°æ¶ˆæ¯ | `Messageå¯¹è±¡` |

### è¾“å…¥çŠ¶æ€äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `typing_start` | `C -> S` | å®¢æˆ·ç«¯å¼€å§‹è¾“å…¥ | `{ room_id: number }` |
| `typing_stop` | `C -> S` | å®¢æˆ·ç«¯åœæ­¢è¾“å…¥ | `{ room_id: number }` |
| `typing_update` | `S -> C` | æœåŠ¡å™¨å¹¿æ’­æˆ¿é—´å†…æ­£åœ¨è¾“å…¥çš„ç”¨æˆ·åˆ—è¡¨ | `{ room_id: number, typing_users: string[] }` |

### ç”¨æˆ·çŠ¶æ€äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `user_status_update` | `S -> C` | ç”¨æˆ·åœ¨çº¿çŠ¶æ€æ›´æ–° | `{ user_id: number, username: string, is_online: boolean }` |
| `online_users_update` | `S -> C` | åœ¨çº¿ç”¨æˆ·åˆ—è¡¨æ›´æ–° | `{ room_id?: number, online_users: User[] }` |

### é”™è¯¯å¤„ç†äº‹ä»¶

| äº‹ä»¶åç§° | æ–¹å‘ | æè¿° | æ•°æ®æ ¼å¼ |
|---------|------|------|----------|
| `error` | `S -> C` | æœåŠ¡å™¨é”™è¯¯é€šçŸ¥ | `{ message: string }` |

### æ•°æ®ç±»å‹å®šä¹‰

```typescript
interface User {
  id: number;
  username: string;
  email: string;
  avatar_url?: string;
  is_online: boolean;
  created_at: string;
  last_seen: string;
}

interface Message {
  id: number;
  content: string;
  timestamp: string;
  user_id: number;
  room_id: number;
  user: {
    id: number;
    username: string;
    avatar_url?: string;
  };
}

interface ChatRoom {
  id: number;
  name: string;
  description?: string;
  is_private: boolean;
  created_at: string;
  creator_id: number;
  member_count: number;
  online_count: number;
}
```

## ğŸ”„ API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

#### POST /api/auth/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“ï¼š**
```json
{
  "username": "string",
  "password": "string",
  "remember_me": "boolean"
}
```

**å“åº”ï¼š**
```json
{
  "message": "æ¬¢è¿å›æ¥ï¼Œusernameï¼",
  "user": Userå¯¹è±¡
}
```

#### POST /api/auth/register
ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚ä½“ï¼š**
```json
{
  "username": "string",
  "email": "string",
  "password": "string",
  "password2": "string"
}
```

#### GET /api/auth/check
æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€

**å“åº”ï¼š**
```json
{
  "authenticated": true,
  "user": Userå¯¹è±¡
}
```

#### POST /api/auth/logout
ç”¨æˆ·ç™»å‡º

### èŠå¤©æ¥å£

#### GET /api/rooms
è·å–èŠå¤©å®¤åˆ—è¡¨

**å“åº”ï¼š**
```json
{
  "user_rooms": ChatRoom[],
  "public_rooms": ChatRoom[]
}
```

#### GET /api/rooms/:id
è·å–èŠå¤©å®¤è¯¦æƒ…

**å“åº”ï¼š**
```json
{
  "room": ChatRoomå¯¹è±¡
}
```

#### POST /api/rooms
åˆ›å»ºèŠå¤©å®¤

**è¯·æ±‚ä½“ï¼š**
```json
{
  "name": "string",
  "description": "string"
}
```

#### POST /api/rooms/:id/join
åŠ å…¥èŠå¤©å®¤

#### POST /api/rooms/:id/leave
ç¦»å¼€èŠå¤©å®¤

#### GET /api/rooms/:id/messages
è·å–èŠå¤©å®¤æ¶ˆæ¯

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤50ï¼‰

**å“åº”ï¼š**
```json
{
  "messages": Message[]
}
```

## ğŸ—ºï¸ æœªæ¥è®¡åˆ’ (Roadmap)

  * [ ] **ç§èŠåŠŸèƒ½**: å®ç°ç”¨æˆ·ä¹‹é—´çš„ä¸€å¯¹ä¸€ç§å¯†èŠå¤©ã€‚
  * [ ] **ç«¯åˆ°ç«¯åŠ å¯† (E2EE)**: ä¸ºæ•æ„Ÿé€šä¿¡å¢åŠ ä¸€å±‚é¢å¤–çš„å®‰å…¨ä¿éšœã€‚
  * [ ] **éŸ³è§†é¢‘é€šè¯**: é›†æˆ WebRTC å®ç°å®æ—¶éŸ³è§†é¢‘èŠå¤©ã€‚
  * [ ] **ç®¡ç†å‘˜åå°**: ç”¨äºç”¨æˆ·ç®¡ç†ã€å†…å®¹å®¡æ ¸å’Œç³»ç»Ÿç›‘æ§ã€‚
  * [ ] **æ•°æ®åº“è¿ç§»**: ä» SQLite è¿ç§»åˆ° PostgreSQL ä»¥æ”¯æŒç”Ÿäº§ç¯å¢ƒã€‚
  * [ ] **å®¹å™¨åŒ–**: æä¾› Dockerfile å’Œ Docker Compose é…ç½®ï¼Œç®€åŒ–éƒ¨ç½²ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æäº¤ Issueã€å‘èµ· Pull Requestï¼Œè¿˜æ˜¯æ”¹è¿›æ–‡æ¡£ï¼Œæˆ‘ä»¬éƒ½éå¸¸æ¬¢è¿ã€‚

1.  Fork æœ¬ä»“åº“
2.  åˆ›å»ºæ‚¨çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3.  æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4.  æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5.  æ‰“å¼€ä¸€ä¸ª Pull Request